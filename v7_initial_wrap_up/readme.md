# Generating simple waveforms using a raspberry pico and micropython 

(directory location is: v7_initial_wrap_up)

This directory should be used to try to finalize the squarewave project. I.e. more focus on documentation and clean code.

## Requirements

The waveform we want to generate can be thought of being generated by three rotation gears. This might help to memorize the signals we want to generate. The circuit will be used to simulate signals used in the control electronics of a car. The examples given here are generic and can be used to generate arbitrary cyclic signals.

The focus of this write down should be to present how easy it is to generate this signals using a raspberry pico and micropython interaction.

*insert svg here,  IGF, CS, CRKS - camshaft, crankshaft, ignition confirmation signal, Crankshaft Position Sensor (CKP), Camshaft Position Sensor (CMP) todo*

Above in the picture you can see three gears. The first gear with a lot of gear tooths can be thought of to generate the *CKP signal* (crankshaft position sensor), the second gear with three gear tooths generates the *CMP signal* (camshaft position sensor) and the third gear with four gear tooths generates the *IGF signal* (ignition confirmation signal). The second and third wheel rotate twice as fast as the first wheel.

You do not have to bother about the abbreviations of the signals - you could also denote the wheels and respective signals A, B, C. Sticking to the abbreviations CKP, CMP and IGF just help me to document my project.

Suppose you put a light sensor at a fixed position that could measure the gear tooths of the rotation wheel passing by. Further on suppose each tooth passing by generates a high signal for 25% and a low signal for 75% of the period of time. So having 34 tooths and 2 gaps in one rotation we can divide the signal corresponding to one rotation into 144 instances in time, e.g. (34+2)\*4. The multiplier corresponds to the 25% percent high state when a tooth passes by. See the following graphical representation:

```
 +---+   +---+   +---+   +--     -+   +---+   +---+                  
 |   |   |   |   |   |   |   ...  |   |   |   |   |
 +   +---+   +---+   +---+        +---+   +---+   +---+---+---+---+---

 1   22   2       3       4            61      62      63      64
 (generate via python)
```

The IGF signal generated by the third gear is inverted, i.e. a gear tooth passing by generates a low signal for 25% and a high signal for 75% of the period of time.

## Raspberry Pico Hardware

The raspberry pico has dedicated hardware to accomplish our task. What we use is PIOs () and DMA (?) hardware.
Unfortunately we have to control the DMA hardware by accessing registers directly. There is not API exposed by the rp2 micropython port.

* we construct an array containing the data for all three signals
* we initialize a state machine (PIO) to listen to the FIFO and set the GPIO pins accordingly
* we set up to two DMA channels:
    * the first channel streams the data from  the array to the FIFO of the state machine
    * the second channel is triggered when the first channel has terminated and restarts the first channel again

##  Links

Details about the directory structure:

```
C:.
├─── diagrams/ generate_wheels.py, generate_ascii.py
├─── circuit/ fritzing
├─── source-code/osci
```


